# SparseXML: A Minimal Embedded XML Parser

## 1. はじめに
`sparsexml`は、ソースコードにそのままコピーして組み込める軽量なXMLパーサとして設計された。既存のXMLライブラリは高機能である反面、バイナリサイズの増加や依存関係の複雑さが課題となる。本プロジェクトでは必要最小限の機能に絞り、単一ファイルで構成されるシンプルさを追求した。

## 2. 関連研究
従来、Rustで利用可能なXMLパーサとして`quick-xml`や`xml-rs`が広く用いられてきた。これらは標準的なXML仕様を幅広くカバーする一方で、イベントドリブンなパースやネームスペース処理など多機能であるがゆえに、利用に際して学習コストが高い。また組み込み用途では依存クレートの数が問題になることが多く、最小構成のXMLパーサが求められてきた。

## 3. 設計
sparsexmlでは「コピー&ペーストで使えること」を最重要目標とし、以下の方針で設計を行った。

1. **単一ソースファイル**: 依存関係を極力排除し、利用者はファイルをプロジェクトに追加するだけで済む。
2. **ストリーム指向の最小パース**: DOM構築は行わず、必要なタグと属性だけを逐次抽出する。
3. **エラー処理の簡略化**: 厳密なXML準拠よりも実用性を優先し、未対応機能は明確にエラーとして返す。

従来ライブラリではネームスペースやDTDなど多くの仕様をサポートするが、小規模ツールでは過剰となる場面が多い。そこで対応範囲を限定することで、読みやすさと改変の容易さを確保した。

## 4. 実装
実装は約300行のRustコードから成り、イベント列挙型`Event`とイテレータ`Parser`のみで構成される。UTF-8限定のシンプルな構造とし、パフォーマンスよりも可読性を重視した。以下に主要ライブラリとの対応機能を比較する。

| 機能                     | sparsexml | quick-xml | xml-rs | 備考 |
|--------------------------|-----------|-----------|--------|------|
| UTF-8以外のエンコーディング | ×         | ○         | ○      | 組み込みを想定しUTF-8のみ対応 |
| ネームスペース解析       | ×         | ○         | ○      | 必要になった時点で拡張可能な設計 |
| DTD/Entity解決          | ×         | △         | ○      | セキュリティ確保のため未対応 |
| DOM構築                  | ×         | ×         | △      | イベント取得のみを想定 |
| ファイル依存なし         | ○         | ○         | ○      | 任意のバッファを入力可能 |

落とした機能はいずれも組み込み用途では使用頻度が低く、実装規模や依存関係を肥大化させる要因となるためである。必要に応じて利用者が拡張できるよう、コードはコメント付きで単純化している。

## 5. おわりに
本稿では軽量XMLパーサ`sparsexml`の設計と実装について述べた。既存ライブラリの過剰な機能をそぎ落とすことで、ソースコードのコピー&ペーストだけで容易に利用できる点が特徴である。今後は利用事例を収集し、必要最小限の範囲内での機能追加を検討していく。
