<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebShark - Network Packet Visualizer</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/styles.css">
    </head>
<body>
    <div class="header">
        <h1>🦈 WebShark</h1>
        <p>Real-time Network Traffic Monitoring</p>
    </div>

    <div class="tabs" role="tablist">
        <button class="tab-btn active" id="topTab" role="tab" aria-selected="true" aria-controls="topView" tabindex="0">
            <span class="tab-icon">📊</span>
            <span>トップビュー</span>
            <span class="tab-badge zero" id="topTabBadge">0</span>
        </button>
        <button class="tab-btn" id="vizTab" role="tab" aria-selected="false" aria-controls="vizView" tabindex="-1">
            <span class="tab-icon">📈</span>
            <span>可視化ビュー</span>
            <span class="tab-badge zero" id="vizTabBadge">0</span>
        </button>
        
        <div class="tab-shortcuts">
            <span class="shortcut-hint" title="Switch tabs">Alt+1/2</span>
            <span class="shortcut-hint" title="Search">Ctrl+F</span>
        </div>
    </div>

        <div class="tab-context-menu" id="tabContextMenu">
        <button class="context-menu-item" onclick="refreshCurrentTab()">
            <span>🔄</span> Refresh Tab
        </button>
        <button class="context-menu-item" onclick="clearCurrentTab()">
            <span>🗑️</span> Clear Data
        </button>
        <button class="context-menu-item" onclick="exportTabData()">
            <span>💾</span> Export Data
        </button>
        <button class="context-menu-item danger" onclick="resetAllTabs()">
            <span>⚠️</span> Reset All
        </button>
    </div>

    <div id="topView" class="view tab-content active" role="tabpanel" aria-labelledby="topTab">
    <div class="container">
                <div class="search-container">
            <span class="search-icon">🔍</span>
            <input type="text" class="search-input" id="topViewSearch" placeholder="Search flows, IPs, protocols...">
        </div>
        <div class="controls">
            <button class="btn" id="startBtn">Start</button>
            <button class="btn danger" id="stopBtn">Stop</button>
            <button class="btn" id="clearBtn">Clear Log</button>
            
            <div class="filter-controls">
                <div class="checkbox-container">
                    <input type="checkbox" id="hideLocalhost" checked>
                    <label for="hideLocalhost">Hide localhost traffic</label>
                </div>
            </div>
            
            <div class="sort-controls">
                <label for="sortSessions">Sort by:</label>
                <select id="sortSessions">
                    <option value="recent">Most Recent</option>
                    <option value="traffic">Traffic Volume</option>
                    <option value="alphabetical">Alphabetical</option>
                </select>
            </div>
        </div>

        <div class="status">
            <div class="status-dot" id="statusDot"></div>
            <span id="statusText">Waiting...</span>
            <span id="memoryStatus" class="memory-info">Memory: 0MB</span>
        </div>

        <div class="advanced-controls">
            <h3>🔧 Advanced Settings</h3>
            <div class="control-row">
                <div class="control-group">
                    <label for="memoryLimit">Memory Limit:</label>
                    <input type="number" id="memoryLimit" value="50" min="10" max="500" step="10">
                    <span>MB</span>
                </div>
                
                <div class="control-group">
                    <label for="maxSessions">Max Sessions:</label>
                    <input type="number" id="maxSessions" value="20" min="5" max="100" step="5">
                </div>
                
                <div class="control-group">
                    <label for="maxPacketsPerSession">Max Packets per Session:</label>
                    <input type="number" id="maxPacketsPerSession" value="50" min="10" max="200" step="10">
                </div>

                <div class="control-group">
                    <input type="checkbox" id="groupLanWan" checked>
                    <label for="groupLanWan">Group by LAN/WAN</label>
                </div>
            </div>
            
            <div class="control-row">
                <div class="control-group">
                    <label for="tsharkFilter">tshark Filter:</label>
                    <input type="text" id="tsharkFilter" class="filter-input" placeholder="e.g. tcp port 80 or udp port 53">
                    <button class="btn" id="applyFilterBtn">Apply</button>
                </div>
            </div>
        </div>

        <div class="dashboard">
            <div class="card">
                <h3>📊 Statistics</h3>
                <div class="stat-item">
                    <span>Total Packets:</span>
                    <span id="totalPackets">0</span>
                </div>
                <div class="stat-item">
                    <span>Connection:</span>
                    <span id="connectionStatus">Disconnected</span>
                </div>
            </div>

            <div class="card">
                <h3>🔗 By Protocol</h3>
                <div id="protocolStats">
                    <div class="stat-item">
                        <span>No data</span>
                        <span>-</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>📍 Top Sources</h3>
                <div id="sourceStats">
                    <div class="stat-item">
                        <span>No data</span>
                        <span>-</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>🎯 Top Destinations</h3>
                <div id="destStats">
                    <div class="stat-item">
                        <span>No data</span>
                        <span>-</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="card packet-log">
            <h3>📡 Smart Communication Flows</h3>
            <div id="flowList"></div>
        </div>
    </div>
    </div>

        <div id="vizView" class="view tab-content" role="tabpanel" aria-labelledby="vizTab">
        <div class="container">
                        <div class="search-container">
                <span class="search-icon">📊</span>
                <input type="text" class="search-input" id="vizViewSearch" placeholder="Filter visualizations, hosts...">
            </div>
            
            <div class="viz-container">
                                <div class="viz-card">
                    <h3>🔗 ネットワークフロー図</h3>
                    <div class="viz-description">ホスト間の通信フローを可視化</div>
                    <div class="viz-content">
                        <svg id="chordDiagram" width="300" height="280"></svg>
                    </div>
                </div>
                
                <div class="viz-card">
                    <h3>📈 時系列トラフィック</h3>
                    <div class="viz-description">時間経過に伴うトラフィック量の変化</div>
                    <div class="viz-content">
                        <canvas id="timeChart" height="280"></canvas>
                    </div>
                </div>
                
                                <div class="viz-card">
                    <h3>📊 累積トラフィック</h3>
                    <div class="viz-description">総トラフィック量の累積推移</div>
                    <div class="viz-content">
                        <canvas id="totalTrafficChart" height="280"></canvas>
                    </div>
                </div>
                
                <div class="viz-card">
                    <h3>🎯 プロトコル分布</h3>
                    <div class="viz-description">ネットワークプロトコルの使用状況</div>
                    <div class="viz-content">
                        <canvas id="protocolChart" height="280"></canvas>
                    </div>
                </div>
                
                                <div class="viz-card">
                    <h3>📤 トップ送信元ホスト</h3>
                    <div class="viz-description">最も多くデータを送信しているホスト</div>
                    <div class="viz-content">
                        <canvas id="topSourcesChart" height="280"></canvas>
                    </div>
                </div>
                
                <div class="viz-card">
                    <h3>📥 トップ宛先ホスト</h3>
                    <div class="viz-description">最も多くデータを受信しているホスト</div>
                    <div class="viz-content">
                        <canvas id="topDestinationsChart" height="280"></canvas>
                    </div>
                </div>
                
                                <div class="viz-card">
                    <h3>📦 パケットサイズ分布</h3>
                    <div class="viz-description">パケットサイズの統計分布</div>
                    <div class="viz-content">
                        <canvas id="packetSizeChart" height="280"></canvas>
                    </div>
                </div>
                
                <div class="viz-card">
                    <h3>🔄 接続状態統計</h3>
                    <div class="viz-description">TCP接続状態とUDPフローの統計</div>
                    <div class="viz-content">
                        <canvas id="connectionStatesChart" height="280"></canvas>
                    </div>
                </div>
                
                                <div class="viz-card">
                    <h3>🌍 地理的分布マップ</h3>
                    <div class="viz-description">IPアドレスの地理的分布（将来実装予定）</div>
                    <div class="viz-content">
                        <div class="viz-placeholder">
                            地理的分布マップ<br>
                            <small>将来の機能拡張で実装予定</small>
                        </div>
                    </div>
                </div>
                
                <div class="viz-card">
                    <h3>⚠️ セキュリティアラート</h3>
                    <div class="viz-description">異常検知とセキュリティアラート（将来実装予定）</div>
                    <div class="viz-content">
                        <div class="viz-placeholder">
                            セキュリティアラート<br>
                            <small>将来の機能拡張で実装予定</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="/static/js/app.js"></script>
    <script src="/static/js/ws.js"></script>
</body>
</html>
